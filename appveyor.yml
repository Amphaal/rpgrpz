version: "0.alpha.{build}"
skip_non_tags: true
image: Visual Studio 2017
platform: x64
environment:
  global:
    APPVEYOR_SAVE_CACHE_ON_ERROR: true
cache:
  - C:\gstreamer\1.0\x86_64
  - C:\ProgramData\chocolatey\bin
  - C:\ProgramData\chocolatey\lib
install:
  #- cmd: choco install pkgconfiglite
  - cmd: set PATH=%PATH%;%PYTHON%/Scripts/
  - cmd: pip.exe install conan
  - cmd: conan user # Create the conan data directory
  - cmd: conan remote add --force bincrafters https://api.bintray.com/conan/bincrafters/public-conan
  - cmd: conan remote add --force rhard https://api.bintray.com/conan/rhard/conan
  # - appveyor DownloadFile https://gstreamer.freedesktop.org/data/pkg/windows/1.16.1/gstreamer-1.0-devel-msvc-x86_64-1.16.1.msi
  # - appveyor DownloadFile https://gstreamer.freedesktop.org/data/pkg/windows/1.16.1/gstreamer-1.0-msvc-x86_64-1.16.1.msi
  # - msiexec /i gstreamer-1.0-devel-msvc-x86_64-1.16.1.msi /quiet /qn /norestart /log install-devel.log ADDLOCAL=ALL
  # - msiexec /i gstreamer-1.0-msvc-x86_64-1.16.1.msi /quiet /qn /norestart /log install.log ADDLOCAL=ALL
build_script:
  - cmd: mkdir build
  - cmd: cd build
  - cmd: conan install .. -s build_type=Release --build missing
  - cmd: cmake --config Release -DOPENSSL_BIN_DIR="C:\OpenSSL-v111-Win64\bin" -DQT_MAIN_DIR="C:\Qt\5.13" -DCMAKE_BUILD_TYPE=Release -G "Visual Studio 15 2017 Win64" .. 
  - cmd: cd ..
  - cmd: cmake --build ./build --target package --config Release
  - cmd: cmake --build ./build --target zipForDeploy --config Release
artifacts:
  - path: build/repository.zip
    name: IFW_Repo
  - path: build/installer.zip
    name: IFW_Installer
deploy:
  - provider: BinTray
    username: amphaal
    api_key:
      secure: yNlQ0sbe2mYcm13rWA7wKuISHE93lndKeIEyGPbHz3mr2oDYQWCNTWXVsExiSJan
    subject: amphaal
    repo: rpgrpz
    package: rpgrpz-ifw-win
    version: latest
    publish: true
    override: true
    explode: true
    artifact: IFW_Repo
  - provider: BinTray
    username: amphaal
    api_key:
      secure: yNlQ0sbe2mYcm13rWA7wKuISHE93lndKeIEyGPbHz3mr2oDYQWCNTWXVsExiSJan
    subject: amphaal
    repo: rpgrpz
    package: rpgrpz-win
    version: latest
    publish: true
    override: true
    explode: true
    artifact: IFW_Installer